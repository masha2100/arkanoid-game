name: Python CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: ‚¨áÔ∏è Checkout —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π
      uses: actions/checkout@v3

    - name: üêç –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ Python
      uses: actions/setup-python@v4
      with:
        python-version: 3.11

    - name: üì¶ –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pytest pytest-html flake8 flake8-html

    - name: ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–∏ –∑ HTML-–∑–≤—ñ—Ç–æ–º
      run: |
        mkdir -p test-reports
        pytest --html=test-reports/report.html --self-contained-html

    - name: üßπ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∏–ª—é –∫–æ–¥—É –∑ flake8
      run: |
        mkdir -p lint-reports
        flake8 . --format=html --htmldir=lint-reports

    - name: üì§ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∏ (–∑–≤—ñ—Ç–∏)
      uses: actions/upload-artifact@v4
      with:
        name: test-lint-reports
        path: |
          test-reports/
          lint-reports/
